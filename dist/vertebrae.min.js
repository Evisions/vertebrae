/*! Vertebrae v0.0.1 */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("vertebrae requires a window with a document");return b(a)}:"function"==typeof define&&define.amd?define("vertebrae",["jquery","backbone","underscore"],b):b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=_.extend({camelCase:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},camelCaseFromNamespace:function(a){a=a.split(".");for(var b=0;b<a.length;b++)a[b]=c.camelCase(a[b]);return a.join("")},formatNumber:function(a){var b=String(a).split("."),c=b[0]||"0",d=b[1]||"",e=c.split("").reverse(),f=[],g="";if(c.length<=3)return String(a);while(e.length)f.push(e.splice(0,3).reverse().join(""));return g=f.reverse().join(","),d&&(g+="."+d),g},toLowerCase:function(a){return String(a).toLowerCase()},unescapeHTML:function(a){return $("<div/>").html(a).text()}});String.camelCase=function(){return c.camelCase.apply(String,arguments)},String.camelCaseFromNamespace=function(){return c.camelCaseFromNamespace.apply(String,arguments)},String.formatNumber=function(){return c.formatNumber.apply(String,arguments)},String.unescapeHTML=function(){return c.unescapeHTML.apply(String,[this])};var d=function(){this.initialize&&this.initialize.apply(this,arguments)};function e(a,b){return function(){var c=this._super;this._super=a;var d=b.apply(this,arguments);return this._super=c,d}}function f(a,b){var c=_.keys(b),d=null,f=0;for(f=0;f<c.length;++f)if(d=c[f],_.isFunction(a[d])&&a[d]!==b[d]){if("constructor"==d)continue;b[d]=e(a[d],b[d])}}d.extend=function(a){var b=[],c=[],d=0,g=0,h=null;if(_.isArray(a.properties)){for(b=a.properties,g=b.length,d=0;g>d;d++)!function(b){var c=function(a,c){return this.set(b,a,c),this},d=function(){return this.get(b)},f=String.camelCase(b);f.indexOf(".")>-1&&(f=String.camelCaseFromNamespace(f));var g="set"+f,h="get"+f;a[g]=_.isFunction(a[g])?e(c,a[g]):c,a[h]=_.isFunction(a[h])?e(d,a[h]):d}(b[d]);_.isArray(this.prototype.properties)&&(c=this.prototype.properties),a.properties=[].concat(b,c)}return h=Backbone.View.extend.apply(this,arguments),f(this.prototype,h.prototype),h},d.prototype={initialize:function(){},_super:function(){return this},applyProperties:function(a){var b,c;for(b in a)c=b.indexOf(".")>-1?"set"+String.camelCaseFromNamespace(b):"set"+String.camelCase(b),_.isFunction(this[c])?this[c](a[b]):this[b]=a[b];return this},destroy:function(){if(this.destroyed=!0,this.stopListening(),this.off(),_.isArray(this.properties)){var a=0,b=null;for(a=0;a<this.properties.length;a++)b=this.properties[a],this.set(b,null,!0)}},destroyProperties:function(){if(_.isArray(this.properties)){var a=0,b=null,c=null;for(a=0;a<this.properties.length;a++)c=this.properties[a],b=this.get(c),b&&_.isFunction(b.destroy)&&b.destroy()}},get:function(a){return a.indexOf(".")>-1?d.getPropertyByNamespace(this,a):this[a]},getter:function(a){var b="get"+c.camelCase(a);return this[b].apply(this,_.toArray(arguments).slice(1))},setter:function(a){var b="set"+c.camelCase(a);return this[b].apply(this,_.toArray(arguments).slice(1))},getProperties:function(){var a={},b=this.properties||[],c=0,d=null,e=null,f=null;for(c=0;c<b.length;++c)f=b[c],d=this["get"+String.camelCase(f)],e=d?d.call(this):this.get(f),void 0!==e&&(a[f]=e);return a},set:function(a,b,c){var e=a.indexOf(".")>-1,f=e?d.getPropertyByNamespace(this,a):this[a],g=f!=b&&!c,h=this;e?d.setPropertyByNamespace(this,a,b):this[a]=b,g&&(this.trigger("change:"+a,this),clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){h.trigger("change")},0))}},_.extend(d,{setPropertyByNamespace:function(a,b,c){b=b||"";var d=b.split("."),e=a,f=null,g=0;if(!(d.length<1)){for(g=0;g<d.length-1;++g)f=d[g],null==e[f]&&(e[f]={}),e=e[f];return f=d[d.length-1],e[f]=c,c}},getPropertyByNamespace:function(a,b){b=b||"";var c=b.split("."),d=a,e=null,f=0;if(c.length<1)return null;for(f=0;f<c.length;++f){if(e=c[f],null==d)return null;if(f===c.length-1)return d[e];d=d[e]}return null}}),_.extend(d.prototype,Backbone.Events);var g=_.extend({},Backbone.Events),h={bindAll:function(a){var b=0,c=[],d=null,e;for(e in a)c.push(e);if(!a||!a.constructor)return a;for(b=0;b<c.length;++b)d=a[c[b]],_.isFunction(d)&&"constructor"!==c[b]&&_.contains(a.constructor.prototype,d)&&(a[c[b]]=_.bind(d,a));return a},fire:function(){return g.trigger.apply(g,arguments),h},trigger:function(){return h.fire.apply(h,arguments)},observe:function(a,b){return g.on.apply(g,arguments),{remove:function(){g.off(a,b)}}},on:function(){return h.observe.apply(h,arguments)}};function i(){var a=this;if(_.isObject(a.observes)){var b=a.observes,c=_.keys(b),d=null,e=0,f=null;for(e=0;e<c.length;++e){if(d=c[e],f=b[d],!_.isFunction(a[f]))throw new Error(f+" does not exist for the global event "+d);this.once("unload",h.observe(d,_.bind(a[f],this)).remove)}}}var j=d.extend({properties:["view"],initialize:function(a){if(this._unbind=[],i.call(this),this.setupView(),!this.getView())throw new Error("A view was not properly assigned.");this.listenToOnce(this.getView(),"change:available",this.viewIsAvailable)},sync:function(a,b,d){var e=a+"DidChange",f=this,g=this.getView(),h=!1,i=c.camelCase(a),j=null,k=null,l=null,m="get"+i,n=b,o="refresh"+i+"PropertyOnView";return b=_.isObject(b)?b:this,j=function(){return b[m]?b[m]():b.get(a)},k=function(){h||(h=!0,f.listenToOnce(g,"change:available",function(){h=!1,l()}))},l=function(){f[o]&&(g.getAvailable()?f[o](j()):k())},this.listenTo(b,"change:"+a,function(){this[e]&&this[e](j()),l()}),l(),(n===!0||d===!0)&&this.trigger("change:"+a),this},destroy:function(){this._unloaded!==!0&&this.unload(),this.trigger("destroy"),this.destroyView(),this._super.apply(this,arguments)},destroyView:function(){var a=this.getView();a&&a.destroy(),this.setView(null)},setupView:function(){if(!this.view)throw"'setupView' needs to be overridden";this.setView(new this.view)},setupViewProperties:function(a,b){return this.getView().setElement(a),this.getView().setDelegate(b||this),this.getView().watchDelegateProperties(),this.viewIsReady(),this},viewIsReady:function(){this.getView().render(),this.getView().setRendered()},viewIsAvailable:function(){},unload:function(a){if(this._unloaded!==!0){this.trigger("unload");var b=this._unbind||[],c=null;while(b.length>0)b.pop().call(this);this._unloaded=!0,this.getView().unload(a)}},validate:function(){return!0},when:function(){return $.when.apply($,arguments)}});j.extend=function(a){return _.isObject(a.observes)&&_.isObject(this.prototype.observes)&&(a.observes=_.extend({},this.prototype.observes,a.observes)),_.isObject(a.validators)&&!_.isFunction(a.validate)&&(a.validate=function(a,b){return Validator(this,b,a)}),d.extend.apply(this,arguments)};var k={},l=Backbone.View.extend({rendered:!1,hidden:!1,available:!1,initialize:function(){h.bindAll(this);var a=this.initialize;this.initialize=null,d.call(this),this.initialize=a,this.listenTo(this,"change:hidden",this.refreshAvailable),this.listenTo(this,"change:rendered",this.refreshAvailable)},destroy:function(){this._super.apply(this,arguments),this.undelegateEvents(),this.$el.empty(),this.$el=null,this.el=null},getDelegate:function(){return this.delegate},getElementDatum:function(a){return this.constructor.datum($(a).closest(".__data__").get(0))},refreshAvailable:function(){this.setAvailable(this.isAvailable()?!0:!1)},whenAvailable:function(){var a=$.Deferred();return this.getAvailable()?a.resolve(this):this.listenToOnce(this,"change:available",function(){a.resolve(this)}),a.promise()},isAvailable:function(){return this.isRendered()&&!this.isHidden()?!0:!1},getAvailable:function(){return this.get("available")},setAvailable:function(a,b){return this.set("available",a,b),this},setRendered:function(){return this.set("rendered",!0),this},isRendered:function(){return!!this.getRendered()},setHidden:function(a,b){return this.set("hidden",a,b),this},isHidden:function(){return!!this.getHidden()},getHidden:function(){return this.get("hidden")},getRendered:function(){return this.get("rendered")},render:function(){},renderFragment:function(a,b,c){var d=$(document.createDocumentFragment()),e=document.createElement("div");return d.append(this.constructor.template(a,b)),c&&this.constructor.datum(d.children().get(0),b),d},renderFragments:function(a,b,c){var d=$(document.createDocumentFragment()),e=null,f=null,g=0;for(g=0;g<b.length;++g)context={index:g,first:0===g,last:g===b.length-1,even:g%2===0,odd:null},context.odd=!context.even,e=$(this.constructor.template(a,b[g],{data:context})),c&&this.constructor.datum(e.get(0),b[g]),d.append(e);return d},setDelegate:function(a){return this.delegate=a,this},template:function(a,b,c){return _.isString(a)||(c=b,b=a,a=this.templateName),_.isArray(b)?this.renderFragments(a,b,c):this.renderFragment(a,b,c)},unload:function(a){this.$el.empty(),_.isFunction(a)&&a()},watchDelegateProperties:function(){}}),m=d.extend(l.prototype);m.setup=function(a,b){a instanceof $&&(a=a.get(0));var c=new this({el:a});return c.setDelegate(b),c.watchDelegateProperties(),c},m.datum=function(a,b){return a?(a instanceof $&&(a=a.get(0)),2==arguments.length&&(a.__data__=b,$(a).addClass("__data__")),a.__data__):void 0},m.getTemplates=function(){return k||{}},m.setupTemplates=function(a){_.isObject(a)&&(k=a)},m.template=function(a,b,c){var d=k[a];return d?d(b||{},c):""},m.extend=function(a){return _.isObject(a.events)&&!a.overrideEvents&&_.isObject(this.prototype.events)&&(a.events=_.extend({},this.prototype.events,a.events)),_.isObject(a.templates)&&(_.isObject(this.prototype.templates)&&(a.templates=_.extend({},this.prototype.templates,a.templates)),_.each(a.templates,function(b,c){_.isFunction(a[b])||(a[b]=function(a,b){return this.template(c,a,b)})})),d.extend.apply(this,arguments)};var n=/\((.*?)\)/g,o=/(\(\?)?:\w+/g,p=/\*\w+/g,q=/[\-{}\[\]+?.,\\\^$|#\s]/g,r=d.extend({initialize:function(a){return this.applyProperties(a),this._super()},updateWith:function(a){return this.applyProperties(a.getProperties()),this},when:function(){return $.when.apply($,arguments)},toJSON:function(){var a={};return this.serverProperties&&this.serverProperties.length&&(a=_.pick(this,this.serverProperties)),a}},{timeout:3e4,parsers:{},rootURI:"/",defaultHandler:function(a){return a},model:function(a){return new this(a)},models:function(a){var b=[],c=(a||[]).length,d=0;for(d=0;c>d;++d)b.push(this.model(a[d]));return b},getAjaxTimeout:function(){return Number(this.timeout)||500},request:function(a,b,c){c||(c={}),b||(b={});var d=$.Deferred(),e=this,f=this.rootURI+a;return _.defaults(c,{data:b,url:f}),c.timeout=this.getAjaxTimeout(),c.jsonBody&&(c.contentType="application/json",c.data=JSON.stringify(c.data),c.processData=!1),c.success=function(f){if(f&&f.valid){var g=e.getParser(a,c.type)||e.defaultHandler;d.resolve(g.call(e,f.data||{},b)||{},b,f)}else d.reject(f||{valid:!1})},c.error=function(a){a.url=f,a.methodType=c.type,d.reject(a)},$.ajax(c),d.promise()},getParser:function(a,b){var c=this._parsers||[],d=c.length,e=0,f=null;for(b=String(b).toLowerCase(),e=0;d>e;++e)if(f=c[e],(!f.type||f.type===b)&&f.uri.test(a))return f.callback},parseParsers:function(){var a=this.rootURI;return _.map(this.parsers||{},function(a,b){var c=null;if("#"==b[0]){var d=b.slice(1).indexOf("#")+1;c=b.slice(1,d).toLowerCase(),b=b.slice(d+1)}return b=b.replace(q,"\\$&").replace(n,"(?:$1)?").replace(o,function(a,b){return b?a:"([^/]+)"}).replace(p,"(.*?)"),{uri:new RegExp("^"+b+"$"),callback:a,type:c}})},post:function(a,b,c){return this.request(a,b,_.defaults(c||{},{type:"POST"}))},get:function(a,b,c){return this.request(a,b,_.defaults(c||{},{type:"GET"}))},put:function(a,b,c){return this.request(a,b,_.defaults(c||{},{type:"PUT",jsonBody:!0}))},del:function(a,b,c){return this.request(a,b,_.defaults(c||{},{type:"DELETE"}))},generateLink:function(b){return a.location.origin+this.rootURI+b}});function s(a){var b={};return _.each(a,function(a,c){var d=c.split(/\s+/),e=String(d[0]).trim().toLowerCase(),f=d.slice(1).join("");"delete"==e&&(e="del"),b[a]=function(a,b){var d=String(f).replace(q,"\\$&").replace(/:\w+/g,function(b){var d=b.slice(1);if(a&&a[d])return a[d];throw new Error("The route "+c+" must include "+d+" in your params")});return this[e](d,a,b)}}),b}r.extend=function(a,b){this.parsers&&b&&b.parsers&&(b._parsers=this.parseParsers.call(b).concat(this._parsers||[])),b&&b.routes&&_.extend(b,s(b.routes));var c=[],e=[];return _.isArray(a.serverProperties)&&(c=a.serverProperties,_.isArray(a.properties)&&(e=a.properties),a.properties=[].concat(c,e)),d.extend.apply(this,arguments)};var t=d.extend({properties:["activeRoute","controller","options","router"],routes:{},controllers:{},defaultRoute:"",initialize:function(a,b){this._super.apply(this,arguments),this.$el=$(a),this.el=this.$el.get(0),this.setOptions(b||{}),this.initializeControllerMappings()},initializeControllerMappings:function(){var a=null,b=this.controllerMappings?this.controllerMappings.length:0,c=0;for(c=0;b>c;++c)a=this.controllerMappings[c],this.setter(a.name,new a.controller(this))},setupControllerMappings:function(){var a=null,b=$.when(),c=null,d=this.controllerMappings?this.controllerMappings.length:0,e=0;for(e=0;d>e;++e)a=this.controllerMappings[e],c=this.getter(a.name),c.setupViewProperties(this.$(a.selector)),c.start&&(b=$.when(b,c.start()));return b},navigate:function(a,b){return this.getRouter().navigate.apply(this,arguments),a},getHash:function(){return Backbone.history.getHash()},hideController:function(){},unloadController:function(){var a=this.getController();return a&&a.unload()},destroyController:function(){var a=this.getController();return a&&a.destroy()},showLoading:function(){},hideLoading:function(){},getContentElement:function(){if(this.content)return this.$(this.content);if(0==this.controllerMappings.length)return this.$el;throw new Error('You must specific the "content" property when using the "controllers" property.')},$:Backbone.View.prototype.$,getInitialRoute:function(){return this.defaultRoute},getControllerPath:function(a){return a},initializeController:function(a){var b=new a,c=b.name||b.contentName,d=this.getContentElement(),e=this._originalClasses||(this._originalClasses=d.attr("class")||" ");return d.empty().removeClass().addClass(e),_.isString(c)&&(c=c.replace(/[\s_]+/g,"-"),d.addClass(c)),_.isString(b.id)&&d.attr("id",b.id),b.setupViewProperties(d),b},setupRoutes:function(){var a={},b=null,c=null;if(!this.routes)return this;for(b in this.routes)a[b]=this.generateRouteHandler(b,this.routes[b]);return c=new Backbone.Router({routes:a}),this.setRouter(c),this},canLeaveCurrentController:function(){return!0},generateRouteHandler:function(a,b){var c=null,d=this;return c=function(){var c=null,e=null,f=arguments,g=this.getActiveRoute(),h=$.Deferred(),i=$.when(i).then(null,function(){return $.Deferred().resolve()});return d.currentRouteDeferred=e=$.when(d.canLeaveCurrentController()).then(function(){return d.showLoading(),_.isString(b)?require([d.getControllerPath(b)],function(a){b=a,h.resolve()}):h.resolve(),i},function(){return a!=g&&d.navigate(g),t.RouteErrors.CANCELLED}).then(function(){return d.setActiveRoute(a),d.trigger("route",a),d.hideController()}).then(function(){return d.showLoading(),$.when(d.unloadController(),h)}).then(function(){return d.destroyController()}).then(function(){return c=d.initializeController(b),d.setController(c),d.trigger("init:controller",c),c.start?c.start.apply(c,f):void 0}).then(function(){d.trigger("start:controller",c)}).always(function(){d.hideLoading()}).fail(function(a){switch(a){case t.RouteErrors.CANCELLED:return}var b=d.routeDidFail(d.getHash(),f);d.setActiveRoute(null),b!==!0&&d.navigate(g||d.defaultRoute,{trigger:!0})})},$.proxy(c,this)},start:function(){this.render();var a=this.setupControllerMappings();return this.setupRoutes(),Backbone.history.start()||this.navigate(this.getInitialRoute(),{trigger:!0,replace:!0}),a},render:function(){return _.isString(this.template)?this.$el.html(m.template(this.template,this.getOptions())):_.isFunction(this.template)&&this.$el.html(this.template(this.getOptions())),this}},{RouteErrors:{CANCELLED:"cancelled"},launch:function(a,b){var c=new this(a,b);return c.start(),c}});t.extend=function(a){return a.controllerMappings=_.isArray(a.controllerMappings)?a.controllerMappings:[],a.properties=_.isArray(a.properties)?a.properties:[],_.each(a.controllers,function(b,c){var d=c.split(/\s+/),e=d[0],f=d.slice(1).join("");e&&f&&a.controllerMappings.push({selector:f,name:e,controller:b})}),_.each(a.controllerMappings,function(b){a.properties.push(b.name)}),_.isArray(this.prototype.controllerMappings)&&(a.controllerMappings=[].concat(this.prototype.controllerMappings,a.controllerMappings)),d.extend.apply(this,arguments)};var u={Object:d,App:t,Controller:j,View:m,Model:r,Event:h},v=a.Vertebrae,w=a.V;return u.noConflict=function(b){return a.V===u&&(a.V=w),b&&a.Vertebrae===u&&(a.Vertebrae=v),u},"undefined"==typeof b&&(a.Vertebrae=a.V=u),u});
//# sourceMappingURL=vertebrae.min.map