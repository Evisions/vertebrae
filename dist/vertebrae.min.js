/*! Vertebrae v0.1.42 */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("vertebrae requires a window with a document");return b(a)}:"function"==typeof define&&define.amd?define("vertebrae",["jquery","backbone","underscore","bluebird"],function(c,d,e,f){return b(a,!0,c,e,d,f)}):b(a)}("undefined"!=typeof window?window:this,function(a,b,c,d,e,f){var g=d.extend({camelCase:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},camelCaseFromNamespace:function(a){a=a.split(".");for(var b=0;b<a.length;b++)a[b]=g.camelCase(a[b]);return a.join("")},formatNumber:function(a){var b=String(a).split("."),c=b[0]||"0",d=b[1]||"",e=c.split("").reverse(),f=[],g="";if(c.length<=3)return String(a);while(e.length)f.push(e.splice(0,3).reverse().join(""));return g=f.reverse().join(","),d&&(g+="."+d),g},toLowerCase:function(a){return String(a).toLowerCase()},unescapeHTML:function(a){return c("<div/>").html(a).text()}});String.camelCase=function(){return g.camelCase.apply(String,arguments)},String.camelCaseFromNamespace=function(){return g.camelCaseFromNamespace.apply(String,arguments)},String.formatNumber=function(){return g.formatNumber.apply(String,arguments)},String.unescapeHTML=function(){return g.unescapeHTML.apply(String,[this])};var h=d.extend({},e.Events),i={bindAll:function(a){var b=0,c=[],e=null,f;for(f in a)c.push(f);if(!a||!a.constructor)return a;for(b=0;b<c.length;++b)e=a[c[b]],d.isFunction(e)&&"constructor"!==c[b]&&d.contains(a.constructor.prototype,e)&&(a[c[b]]=d.bind(e,a));return a},fire:function(){return h.trigger.apply(h,arguments),i},trigger:function(){return i.fire.apply(i,arguments)},observe:function(a,b){return h.on.apply(h,arguments),{remove:function(){h.off(a,b)}}},on:function(){return i.observe.apply(i,arguments)}},j={createSuper:function(a,b){return function(){var c=this._super;this._super=a;var d=b.apply(this,arguments);return this._super=c,d}},createSuperForOverriddenFunctions:function(a,b){var c=d.keys(b),e=null,f=0;for(f=0;f<c.length;++f)if(e=c[f],d.isFunction(a[e])&&a[e]!==b[e]){if("constructor"==e||"view"==e)continue;b[e]=j.createSuper(a[e],b[e])}},createGettersAndSetters:function(a,b){var c=function(a,c){return this.set(b,a,c)},e=function(){return this.get(b)},f=g.camelCase(b);f.indexOf(".")>-1&&(f=g.camelCaseFromNamespace(f));var h="set"+f,i="get"+f;a[h]=d.isFunction(a[h])?j.createSuper(c,a[h]):c,a[i]=d.isFunction(a[i])?j.createSuper(e,a[i]):e},mergeClassProperty:function(a,b,c,e){var f=null;return d.isFunction(e)&&d.each(a[c],e),d.isArray(a[c])?(f=[],f=d.isArray(b[c])?f.concat(b[c],a[c]):f.concat(a[c])):d.isObject(a[c])&&(f={},d.isObject(b[c])?d.extend(f,b[c],a[c]):d.extend(f,a[c])),f&&(a[c]=f),a},setupInstanceEvents:function(a){if(d.isObject(a.events)){var b=d.keys(a.events),c=null,e=null,f=b.length,g=0;for(g=0;f>g;++g)if(c=b[g],e=a.events[c]){if(!a[e])throw new Error(e+" does not exist on this controller");a.listenTo(a,c,a[e])}}},setupInstanceObserves:function(a){if(d.isObject(a.observes)){var b=a.observes,c=d.keys(b),e=null,f=0,g=null;for(f=0;f<c.length;++f){if(e=c[f],g=b[e],!d.isFunction(a[g]))throw new Error(g+" does not exist for the global event "+e);a.once("unload",i.observe(e,d.bind(a[g],a)).remove)}}},makeFunction:function(a){return d.isFunction(a)?a:function(){}},createError:function(a,b,c){function d(e){return this instanceof d?(c&&c.apply(this,arguments),this.message="string"==typeof e?e:b,this.name=a,void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new d(e)}return j.inherit(d,c||Error),d},inherit:function(a,b){var c={}.hasOwnProperty;for(var d in b)c.call(b,d)&&(a[d]=b[d]);function e(){this.constructor=a}return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a}},k=function(){this.initialize&&this.initialize.apply(this,arguments),this.trigger("init")};k.extend=function(a){var b=null;return j.mergeClassProperty(a,this.prototype,"properties",function(b){j.createGettersAndSetters(a,b)}),b=e.View.extend.apply(this,arguments),j.createSuperForOverriddenFunctions(this.prototype,b.prototype),b},k.prototype={initialize:function(){},_super:function(){return this},applyProperties:function(a,b){var c=null,e=null;b=d.defaults(b||{},{replaceFunctions:!1}),a instanceof k&&(a=a.getProperties());for(c in a)e=c.indexOf(".")>-1?"set"+g.camelCaseFromNamespace(c):"set"+g.camelCase(c),d.isFunction(this[e])?this[e](a[c]):(!d.isFunction(this[c])||b.replaceFunctions)&&(this[c]=a[c]);return this},destroy:function(){if(this.trigger("destroy"),this.destroyed=!0,this.stopListening(),this.off(),d.isArray(this.properties)){var a=0,b=null;for(a=0;a<this.properties.length;a++)b=this.properties[a],this.set(b,null,{silent:!0})}},destroyProperties:function(){if(d.isArray(this.properties)){var a=0,b=null,c=null;for(a=0;a<this.properties.length;a++)c=this.properties[a],b=this.get(c),b&&d.isFunction(b.destroy)&&b.destroy()}},get:function(a){return a.indexOf(".")>-1?k.getPropertyByNamespace(this,a):this[a]},pick:function(){var a=d.toArray(arguments),b={},c=0,e=0,f=null,g=[];for(g=d.isArray(a[0])?a[0]:a,e=0,c=g.length;c>e;++e)f=g[e],b[f]=this.getter(f);return b},hasGetter:function(a){return d.isFunction(this["get"+g.camelCase(a)])},hasSetter:function(a){return d.isFunction(this["set"+g.camelCase(a)])},getter:function(a){var b="get"+g.camelCase(a);return this[b].apply(this,d.toArray(arguments).slice(1))},setter:function(a){var b="set"+g.camelCase(a);return this[b].apply(this,d.toArray(arguments).slice(1))},getProperties:function(){var a={},b=this.properties||[],c=0,d=null,e=null,f=null;for(c=0;c<b.length;++c)f=b[c],d=this["get"+String.camelCase(f)],e=d?d.call(this):this.get(f),void 0!==e&&(a[f]=e);return a},set:function(a,b,c){var e=a.indexOf(".")>-1,g=e?k.getPropertyByNamespace(this,a):this[a],h=!1,i=null,j=this;return c=c||{},d.defaults(c,{trigger:g!=b,promise:!1,silent:!1}),h=c.trigger&&!c.silent,c.promise===!0&&b instanceof f&&(h=!1,i=f.resolve(b).bind(this).tap(function(b){this.set(a,b,c)})),e?k.setPropertyByNamespace(this,a,b):this[a]=b,h&&(this.trigger("change:"+a,this,b,g),clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){j.trigger("change",this,a,b,g)},0)),i||this}},d.extend(k,{setPropertyByNamespace:function(a,b,c){b=b||"";var d=b.split("."),e=a,f=null,g=0;if(!(d.length<1)){for(g=0;g<d.length-1;++g)f=d[g],null==e[f]&&(e[f]={}),e=e[f];return f=d[d.length-1],e[f]=c,c}},getPropertyByNamespace:function(a,b){b=b||"";var c=b.split("."),d=a,e=null,f=0;if(c.length<1)return null;for(f=0;f<c.length;++f){if(e=c[f],null==d)return null;if(f===c.length-1)return d[e];d=d[e]}return null}}),d.extend(k.prototype,e.Events);var l=function(a,b,c){var e=null,f=null;if(a)return b||(b=a.getView()),e=a.validators||{},f=d.chain(e).map(function(e,f){if(c&&!d.contains(c,f))return!0;var g=j.makeFunction(b[o(f)]),h=j.makeFunction(b[m(f)]),i=j.makeFunction(b[n(f)]),k="",p=!1;return k=g.call(b),p=l.validateValueWithMiddleware(k,f,e,a),p===!0?(i.call(b),!0):(h.call(b,p+""),!1)}).reject(function(a){return a}).value(),f.length?!1:!0};function m(a){return"show"+g.camelCase(a)+"Error"}function n(a){return"show"+g.camelCase(a)+"Success"}function o(a){return"get"+g.camelCase(a)}l.validateValueWithMiddleware=function(a,b,e,f){d.isFunction(e)?e=[e].concat(c.makeArray(arguments).slice(2)):d.isArray(e)||(e=[]);var g=0,h=null,i=!1;for(g=0;g<e.length;++g)if(h=e[g],d.isString(h)&&(h=f[h]),i=h.call(f,a,b),i!==!0)return i;return!0},l.validators={},l.validators.checkLength=function(a,b,c,d){return function(e,f){if(String(e)===e){if(e.length<a)return c||"This field must be a minimum length of "+a+".";if(e.length>b)return d||"This field cannot have a length greater than "+b+"."}return!0}},l.validators.email=function(a){return function(b,c){var d=/[a-z0-9!#$%&\'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&\'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+(?:[A-Z]{2}|com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|museum|edu)\b/i;return b?d.test(b)?!0:a||"An invalid email address was entered.":!0}},l.validators.phone=function(a){return function(b,c){var d=/\(?([0-9]{3})\)?([ .-]?)([0-9]{3})\2([0-9]{4})/;return b?d.test(b)?!0:a||"An invalid phone number was entered.":!0}},l.validators.postalCode=function(a){return function(b,c){var d=/^\d{5}(-\d{4})?$/g;return b?d.test(b)?!0:a||"An invalid postal code was entered.":!0}},l.validators.empty=function(a){return function(b,c){return String(null==b?"":b).trim()?!0:a||"This field cannot be empty."}},l.validators.date=function(a){return a=a||"This is an invalid date.",function(b,c){if(d.isDate(b))try{var e=b.getTime();if(d.isNaN(e))return a}catch(f){return a}return!0}},l.validators.number=function(a){return a=a||"This is an invalid number.",function(b,c){return String(b).length>0&&d.isNaN(Number(b))?a:b%1!=0?"Decimal points are not allowed.":!0}},l.validators.numberBetween=function(a,b,c){return c=c||"This is an invalid number.",function(e,f){return String(e).length>0&&d.isNaN(Number(e))?c:e%1!=0?"Decimal points are not allowed.":a>e||e>b?c:!0}};var p=k.extend({properties:["view"],events:{"view:ready":"render","view:available":null},initialize:function(a){if(this._unbind=[],j.setupInstanceObserves(this),j.setupInstanceEvents(this),this.setupView(),!this.getView())throw new Error("A view was not properly assigned.");this.listenToOnce(this.getView(),"change:available",function(){this.trigger("view:available"),this.viewIsAvailable()})},sync:function(a,b,c,e){var f=String(a).split("."),h=f.slice(0,-1).join("."),i=f.slice(-1).join(""),j=null,l=this,m=null,n=!1,o=g.camelCaseFromNamespace(a),p=g.camelCase(i),q=void 0,r=null,s=null,t=null,u=null,v=this,w=null,x=function(){return!0};return h&&(v=k.getPropertyByNamespace(this,h)),d.isFunction(b)&&(e=c,c=b,b={trigger:!0,targetHandler:null,viewHandler:null}),b=d.defaults(b||{},{trigger:!1,triggerView:!0,accessor:"get"+p,target:v,targetHandler:i+"DidChange",viewHandler:"refresh"+o+"PropertyOnView",filter:null,view:this.getView(),fn:c,context:e}),m=b.view,u=b.accessor,j=b.targetHandler,w=b.viewHandler,v=b.target,b.filter&&(d.isString(b.filter)&&d.isFunction(this[b.filter])?x=this[b.filter]:d.isFunction(b.filter)&&(x=b.filter)),r=function(){return v[u]?v[u]():v.get(i)},s=function(a){n||(n=!0,l.listenToOnce(m,"change:available",function(){n=!1,t(a)}))},t=function(a){l[w]&&(m.getAvailable()?l[w](r(),a):s(a))},this.listenTo(v,"change:"+i,function(){var c=r();x.call(this,a)&&(this[j]&&this[j](c,q),d.isFunction(b.fn)&&b.fn.call(b.context||this,c,q),t(q),q=c)}),b.triggerView===!0&&x.call(this,a)&&t(),b.trigger===!0&&v.trigger&&v.trigger("change:"+i),q=r(),this},bind:function(a,b,c){return c=d.defaults(c||{},{filter:function(){}}),c.filter&&(d.isString(c.filter)?c.filter=this[c.filter]:d.isFunction(c.filter)||(c.filter=function(){})),this.listenTo(this,a,function(){c.filter.call(this,a)&&b.apply(this,arguments)}),this},isViewAvailable:function(){return this.getView()?this.getView().isAvailable():!1},destroy:function(){this._unloaded!==!0&&this.unload(),this.destroyView(),this._super.apply(this,arguments)},destroyView:function(){var a=this.getView();a&&a.destroy(),this.setView(null)},setupView:function(){if(!this.view)throw"'setupView' needs to be overridden";this.setView(new this.view)},setup:function(a,b){return b=d.defaults(b||{},{delegate:this}),this.getView().setElement(a),this.getView().setDelegate(b.delegate),this.getView().watchDelegateProperties(),this.trigger("setup"),this.trigger("view:ready"),this.viewIsReady(),this},viewIsReady:function(){},render:function(){var a=this.getView();a.render.apply(a,arguments),a.setRendered(),this.trigger("view:render")},viewIsAvailable:function(){},unload:function(a){if(this._unloaded!==!0){var b=this._unbind||[],c=null;while(b.length>0)b.pop().call(this);this._unloaded=!0,this.trigger("unload"),this.getView().unload(a)}},validate:function(){return!0}});p.extend=function(a){return j.mergeClassProperty(a,this.prototype,"observes"),j.mergeClassProperty(a,this.prototype,"events"),d.isObject(a.validators)&&!d.isFunction(a.validate)&&(a.validate=function(a,b){return l(this,b,a)}),k.extend.apply(this,arguments)};var q={},r={},s=e.View.extend({rendered:!1,hidden:!1,available:!1,initialize:function(){var a=this.initialize;this.initialize=function(){},k.call(this),e.View.call(this),e.View.prototype.initialize.apply(this,arguments),this.initialize=a,this.listenTo(this,"change:hidden",this.refreshAvailable),this.listenTo(this,"change:rendered",this.refreshAvailable)},destroy:function(){this._super.apply(this,arguments),this.undelegateEvents(),this.$el.empty(),this.$el=null,this.el=null},getDelegate:function(){return this.delegate},getElementDatum:function(a){return this.constructor.datum(c(a).closest(".__data__").get(0))},refreshAvailable:function(){this.setAvailable(this.isAvailable()?!0:!1)},isAvailable:function(){return this.isRendered()&&!this.isHidden()?!0:!1},getAvailable:function(){return this.get("available")},setAvailable:function(a,b){return this.set("available",a,b),this},setRendered:function(){return this.set("rendered",!0),this},isRendered:function(){return!!this.getRendered()},setHidden:function(a,b){return this.set("hidden",a,b),this},isHidden:function(){return!!this.getHidden()},getHidden:function(){return this.get("hidden")},getRendered:function(){return this.get("rendered")},render:function(){},renderFragment:function(a,b,d){var e=c(document.createDocumentFragment()),f=document.createElement("div");return e.append(this.constructor.template(a,b,{},this.templateNamespace)),d&&this.constructor.datum(e.children().get(0),b),e},renderFragments:function(a,b,d){var e=c(document.createDocumentFragment()),f=null,g=null,h=0;for(h=0;h<b.length;++h)context={index:h,first:0===h,last:h===b.length-1,even:h%2===0,odd:null},context.odd=!context.even,f=c(this.constructor.template(a,b[h],{data:context},this.templateNamespace)),d&&this.constructor.datum(f.get(0),b[h]),e.append(f);return e},setDelegate:function(a){return this.delegate=a,this.trigger("change:delegate",a),this},template:function(a,b,c){return d.isString(a)||(c=b,b=a,a=this.templateName),d.isArray(b)?this.renderFragments(a,b,c):this.renderFragment(a,b,c)},unload:function(a){this.$el.empty(),d.isFunction(a)&&a()},watchDelegateProperties:function(){}}),t=k.extend(s.prototype);t.setup=function(a,b){a instanceof c&&(a=a.get(0));var d=new this({el:a});return d.setDelegate(b),d.watchDelegateProperties(),d},t.datum=function(a,b){return a?(a instanceof c&&(a=a.get(0)),2==arguments.length&&(a.__data__=b,c(a).addClass("__data__")),a.__data__):void 0},t.getTemplates=function(a){return a?r[a]||{}:q||{}},t.setupTemplates=function(a,b){d.isObject(a)&&(d.isString(b)?r[b]=a:q=a)},t.template=function(a,b,c,d){var e=null;return e=d?(r[d]||{})[a]:q[a],e?e(b||{},c):""},t.hasTemplate=function(a,b){return b?r[b]&&r[b][a]?!0:!1:q[a]?!0:!1},t.templateExists=t.hasTemplate,t.extend=function(a){return d.each(a.events,function(b,c){if(String(b).indexOf(".")>-1){var d=b.split(".");a.events[c]=function(){var a=k.getPropertyByNamespace(this,b),c=k.getPropertyByNamespace(this,d.slice(0,-1).join("."));return a.apply(c,arguments)}}}),d.isObject(a.events)&&!a.overrideEvents&&d.isObject(this.prototype.events)&&(a.events=d.extend({},this.prototype.events,a.events)),d.isObject(a.templates)&&(d.isObject(this.prototype.templates)&&(a.templates=d.extend({},this.prototype.templates,a.templates)),d.each(a.templates,function(b,c){d.isFunction(a[b])||(a[b]=function(a,b){return this.template(c,a,b)})})),k.extend.apply(this,arguments)};var u=/\((.*?)\)/g,v=/(\(\?)?:\w+/g,w=/\*\w+/g,x=/[\-{}\[\]+?.,\\\^$|#\s]/g,y=k.extend({initialize:function(a){return d.isFunction(this.defaults)&&(a=d.defaults(d.clone(a),this.defaults())),this.applyProperties(a),this._super()},updateWith:function(a){return this.applyProperties(a.getProperties()),this},toJSON:function(){var a={};return this.serverProperties&&this.serverProperties.length&&(a=d.pick(this,this.serverProperties)),a}},{timeout:3e4,parsers:{},rootURI:"/",defaultHandler:function(a){return a},model:function(a){return new this(a)},models:function(a){var b=[],c=(a||[]).length,d=0;for(d=0;c>d;++d)b.push(this.model(a[d]));return b},getAjaxTimeout:function(){return Number(this.timeout)||500},request:function(a,b,c){c||(c={}),b||(b={});var e=this,f=this.getResponseDefaults(),g=(this.rootUrl||this.rootURI)+a;return d.defaults(c,{data:b,url:g}),c.timeout=this.getAjaxTimeout(),c.jsonBody&&(c.contentType="application/json",c.data=JSON.stringify(c.data),c.processData=!1),this.ajax(c).then(function(){return e.processResponse.apply(e,arguments)}).then(function(d){var f=e.getParser(a,c.type)||e.defaultHandler;return e.resolve(f.call(e,d,b)||{})})},processResponse:function(a,b,c){return this.getResponseDefaults()&&(a=d.defaults(a||{},this.getResponseDefaults())),this.isValidResponse(a||{},b,c)?this.getResponseSuccessPayload(a||{}):this.reject(this.getResponseFailPayload(a||{}))},ajax:function(a){return f.resolve(e.ajax(a))},reject:function(a){return f.reject(a)},resolve:function(a){return f.resolve(a)},isValidResponse:function(a){return!!a},getResponseDefaults:function(){return null},getResponseSuccessPayload:function(a){return a},getResponseFailPayload:function(a){return a},getParser:function(a,b){var c=this._parsers||[],d=c.length,e=0,f=null;for(b=String(b).toLowerCase(),e=0;d>e;++e)if(f=c[e],(!f.type||f.type===b)&&f.uri.test(a))return f.callback},post:function(a,b,c){return this.request(a,b,d.defaults(c||{},{type:"POST"}))},get:function(a,b,c){return this.request(a,b,d.defaults(c||{},{type:"GET"}))},put:function(a,b,c){return this.request(a,b,d.defaults(c||{},{type:"PUT",jsonBody:!0}))},del:function(a,b,c){return this.request(a,b,d.defaults(c||{},{type:"DELETE"}))},generateLink:function(a){return window.location.protocol+"//"+window.location.host+this.rootURI+a}});function z(a){var b={},c=null,e=["POST","GET","PUT","DEL"],f=null;return f={POST:"requestCreate",GET:"requestOne",PUT:"requestUpdate",DEL:"requestDelete"},c=function(a,h){var i=String(h).trim().split(/\s+/),j=String(i[0]).trim().toLowerCase(),k=null,l=i.slice(1).join("");if(d.isString(a))k=a,a=null;else{if(!d.isObject(a))throw new Error("The value of the model route mapping must be a string or an object.");k=a.fn}if("delete"==j)j="del";else if("crud"==j)return void d.each(e,function(a){var b=a+" "+l;switch(a){case"GET":b+="/:$0";break;case"PUT":case"DEL":b+="/:id"}c(f[a]+g.camelCase(k),b)});b[k]=function(b,c){var e=arguments,f=0,g=[],i=d.clone(b),k=String(l).replace(/:[\$]?\w+/g,function(a){var b=a.slice(1),c=null;if("$"==b[0])return c=e[f++];if(i&&i[b])return c=i[b],g.push(b),c;throw new Error("The route "+h+" must include "+b+" in your params")});return i=d.clone(e[f++])||{},c=d.clone(e[f])||{},d.each(g,function(a){delete i[a]}),a&&d.defaults(c,a),this[j](k,i,c)}},d.each(a,c),b}function A(a){var b=a.rootURI;return d.map(a.parsers||{},function(a,b){var c=b.split(/\s+/),e=c.length>1,f=e?String(c[0]).trim().toLowerCase():null,b=e?c.slice(1).join(""):c.join("");if("#"==b[0]){var g=b.slice(1).indexOf("#")+1;f=b.slice(1,g).toLowerCase(),b=b.slice(g+1)}if(b=b.replace(x,"\\$&").replace(u,"(?:$1)?").replace(v,function(a,b){return b?a:"([^/]+)"}).replace(w,"(.*?)"),d.isString(a)){var h=a;a=function(){return this[h].apply(this,arguments)}}return{uri:new RegExp("^"+b+"$"),callback:a,type:f}})}y.extend=function(a,b){this.parsers&&b&&b.parsers&&(b._parsers=A(b).concat(this._parsers||[])),b&&b.routes&&d.extend(b,z(b.routes));var c=[],e=[];return d.isArray(a.serverProperties)&&(c=a.serverProperties,d.isArray(a.properties)&&(e=a.properties),a.properties=[].concat(c,e)),k.extend.apply(this,arguments)};var B=k.extend({properties:["currentRoute","contentController","options","router"],routes:{},controllers:{},events:{start:"routing"},defaultRoute:"",initialize:function(a,b){j.setupInstanceEvents(this),j.setupInstanceObserves(this),this.$el=c(a),this.el=this.$el.get(0),this.setOptions(b||{}),this.history=[],this.initializeControllerMappings(),d.isFunction(this.handleAppErrors)&&f.onPossiblyUnhandledRejection(d.bind(this.handleAppErrors,this)),this._super.apply(this,arguments)},initializeControllerMappings:function(){var a=null,b=this.controllerMappings?this.controllerMappings.length:0,c=[],e=0;for(e=0;b>e;++e)a=d.clone(this.controllerMappings[e]),a.instance=new a.controller(this),a.name&&(this[a.name]=a.instance),c.push(a);return this.controllerMappings=c,this},setupControllerMappings:function(){var a=null,b=f.resolve(),c=null,d=this.controllerMappings?this.controllerMappings.length:0,e=0;for(e=0;d>e;++e)a=this.controllerMappings[e],c=a.instance,c.setup(this.$(a.selector)),c.start&&(b=f.join(b,c.start()));return b},navigate:function(a,b){if(b=d.extend({},b),!b.trigger){var c=this.getContentController();this.history.push({name:c.name,route:a})}return this.getRouter().navigate.apply(this,arguments),a},navigateBack:function(a){this.history.pop();var b=this.history.pop();return b?(this.getRouter().navigate(b.route,d.extend({trigger:!0},a)),b.route):null},lastPage:function(){return d.clone(this.history[this.history.length-2])},getHash:function(){return e.history.getHash()},hideController:function(){},destroyContentController:function(){var a=this.getContentController();return a&&a.destroy()},showLoading:function(){},getContentElement:function(){if(this.content)return this.$(this.content);if(0==this.controllerMappings.length)return this.$el;throw new Error('You must specific the "content" property when using the "controllers" property.')},$:e.View.prototype.$,getInitialRoute:function(){return this.defaultRoute},getControllerPath:function(a){return a},initializeContentController:function(a){var b=new a(this),c=this.getContentElement(),e=this._originalClasses||(this._originalClasses=c.attr("class")||" ");return c.empty().removeClass().addClass(e),d.isString(b.name)&&c.addClass(b.name.replace(/[\s_]+/g,"-")),d.isString(b.contentName)&&c.addClass(b.contentName),d.isString(b.className)&&c.addClass(b.className),d.isString(b.id)&&c.attr("id",b.id),this.setContentController(b),b.setup(c),b},canLeaveContentController:function(){return!0},canSetupController:function(a){return!0},clearCurrentRoute:function(){this.setCurrentRoute(null)},setupRoutes:function(){var a={};return d.each(this.routes,function(b,c){a[c]=function(){var a=null,c=arguments,e=this.getCurrentRoute()||this.defaultRoute,g=this.currentRouteDeferred,h=f.defer(),i=function(){},j=null;return this.currentRouteDeferred=f.resolve(this.canLeaveContentController()).bind(this).then(function(){this.routeDidChange(this.getHash()),i=this.showLoading(),d.isString(b)?require([this.getControllerPath(b)],function(a){j=a,h.resolve()}):(j=b,h.resolve())}).then(this.slideOutContentController).caught(B.Errors.NavigationCancelled,function(a){throw this.navigate(e),a}).tap(function(){return new f(function(a){f.resolve(g).lastly(a)})}).then(function(){return h.promise}).then(function(){return this.destroyContentController()}).then(function(){if(!this.canSetupController(j))throw new B.Errors.CannotRoute;return a=this.initializeContentController(j),this.trigger("init:content-controller",a),this.history.push({route:this.getHash(),name:a.name}),d.isFunction(a.start)&&a.start.apply(a,c)}).then(function(){a.hasSetter("started")?a.setStarted(!0):a.set("started",!0),a.trigger("data:ready"),this.trigger("start:content-controller",a),this.getContentElement().addClass("in")}).lastly(function(){d.isFunction(i)&&i()}).caught(function(a){if(!(a instanceof B.Errors.NavigationCancelled)){var b=this.routeDidFail(this.getHash(),c);throw this.getCurrentRoute()==this.defaultRoute?this.clearCurrentRoute():(this.clearCurrentRoute(),b!==!0&&this.navigate(e,{trigger:!0})),a}})},a[c]=d.bind(a[c],this)},this),this.setRouter(new e.Router({routes:a})),this},routeDidChange:function(a){this.setCurrentRoute(a)},routeDidFail:function(){},start:function(){this.render();var a=this.setupControllerMappings();return this.trigger("start"),a},routing:function(a){this.setupRoutes(),e.history.start()||this.navigate(a||this.getInitialRoute(),{trigger:!0,replace:!0})},render:function(){return d.isString(this.template)?this.$el.html(t.template(this.template,this.getOptions())):d.isFunction(this.template)&&this.$el.html(this.template(this.getOptions())),this}},{Errors:{NavigationCancelled:j.createError("NavigationCancelled"),CannotRoute:j.createError("CannotRoute")},launch:function(a,b){var c=new this(a,b);return c.start(),c},start:function(a,b){return this.launch.apply(this,arguments)}});B.extend=function(a){var b=d.isArray(a.controllerMappings)?a.controllerMappings:[];return d.each(a.controllers,function(a,c){var d=String(c).trim().split(/\s+/),e=d.length>1?d[0]:null,f=e?d.slice(1).join(""):d.join("");e&&f&&b.push({selector:f,name:e,controller:a})}),a.controllerMappings=b,j.mergeClassProperty(a,this.prototype,"events"),j.mergeClassProperty(a,this.prototype,"observes"),j.mergeClassProperty(a,this.prototype,"routes"),j.mergeClassProperty(a,this.prototype,"controllerMappings"),k.extend.apply(this,arguments)};var C={Object:k,App:B,Controller:p,View:t,Model:y,Event:i,String:g,Utils:j,Validator:l,version:"0.1.42"},D=a.Vertebrae,E=a.V;return C.noConflict=function(b){return a.V===C&&(a.V=E),b&&a.Vertebrae===C&&(a.Vertebrae=D),C},"undefined"==typeof b&&(a.Vertebrae=a.V=C),C});
//# sourceMappingURL=vertebrae.min.map